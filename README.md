# JFrog Artifactory CircleCI Orb v2

CircleCI Orb for JFrog Artifactory with JFrog CLI v2 support.

## Architecture

Based on: [../jfrog-plugin-generator/DESIGN.md](../jfrog-plugin-generator/DESIGN.md)

```
artifactory-orb-2/
├── cli-wrapper/           # Reusable CLI scripts (GENERIC)
│   ├── install.sh
│   ├── configure.sh
│   ├── upload.sh
│   ├── download.sh
│   ├── build-info.sh
│   ├── scan.sh
│   └── docker.sh
│
├── src/                   # CircleCI-specific source (PLATFORM)
│   ├── @orb.yml           # Orb metadata (edit this)
│   ├── commands/
│   ├── jobs/
│   ├── executors/
│   └── examples/
│
├── orb.yml                # Generated by: circleci orb pack src
│                          # (Do not edit, do not commit)
├── test-config.yml        # Test configuration
└── TESTING.md             # Testing guide
```

**Important:** There are two files with "orb.yml" in the name:
- `src/@orb.yml` - Source metadata (manually edited, committed to git)
- `orb.yml` - Packed orb (generated, excluded from git)

## Quick Start

```yaml
version: 2.1

orbs:
  artifactory: jfrog/artifactory-orb@2.0.0

workflows:
  build:
    jobs:
      - artifactory/upload:
          source: "target/*.jar"
          target: "libs-release-local/"
          build-steps:
            - run: mvn clean package
          context: jfrog-context
```

## Setup

Create a CircleCI context named `jfrog-context` with:

```
ARTIFACTORY_URL=https://yourcompany.jfrog.io
ARTIFACTORY_ACCESS_TOKEN=your-access-token
```

Or use username/password:

```
ARTIFACTORY_URL=https://yourcompany.jfrog.io
ARTIFACTORY_USER=your-username
ARTIFACTORY_PASSWORD=your-password
```

## Commands

| Command | Description |
|---------|-------------|
| `install` | Install JFrog CLI v2 |
| `configure` | Configure Artifactory connection |
| `upload` | Upload artifacts |
| `download` | Download artifacts |
| `build-integration` | Publish build info |
| `scan` | Xray security scan |
| `docker-login` | Login to Docker registry |
| `docker-push` | Push Docker image |
| `docker-promote` | Promote Docker image |

## Jobs

| Job | Description |
|-----|-------------|
| `upload` | Build and upload artifacts |
| `docker-publish` | Build and push Docker image |
| `docker-promote` | Promote Docker image |

## Changes from v1.0.1

| Feature | v1.0.1 | v2.0.0 |
|---------|--------|--------|
| CLI Version | v1 (deprecated) | v2 |
| Config Command | `jfrog rt c` | `jf config add` |
| Auth Methods | API Key only | Access Token + User/Pass |
| Server ID | None | Yes (default: circleci-rt) |
| URL Flag | `--url` | `--artifactory-url` |

## Development

```bash
# Validate orb
circleci orb validate src/@orb.yml

# Pack orb
circleci config pack src > orb.yml

# Publish dev version
circleci orb publish orb.yml jfrog/artifactory-orb@dev:alpha
```

## License

Apache 2.0

